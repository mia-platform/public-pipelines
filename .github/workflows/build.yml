name: Image Building

on:
  workflow_dispatch:
  schedule:
  - cron: "0 0 1,15 * *"

jobs:
  rebuild-base:
    uses: ./.github/workflows/build-image.yml
    strategy:
      matrix:
        params:
        - tag: "1"
          build_args: ""
    with:
      image_path: containers/base
      image_name: base-pipeline
      image_tag: ${{ matrix.params.tag }}
      build_args: ${{ matrix.params.build_args }}
    secrets: inherit

  rebuild-docker:
    needs: rebuild-base
    uses: ./.github/workflows/build-image.yml
    strategy:
      matrix:
        params:
        - tag: "1"
          build_args: ""
    with:
      image_path: containers/docker
      image_name: docker-pipeline
      image_tag: ${{ matrix.params.tag }}
      build_args: ${{ matrix.params.build_args }}
    secrets: inherit

  rebuild-go:
    needs: rebuild-base
    uses: ./.github/workflows/build-image.yml
    strategy:
      matrix:
        params:
        - tag: "1.24"
          build_args: |
            GO_VERSION=1.24.7
            GO_CHECKSUM=da18191ddb7db8a9339816f3e2b54bdded8047cdc2a5d67059478f8d1595c43f
            GO_CHECKSUM_ARM=fd2bccce882e29369f56c86487663bb78ba7ea9e02188a5b0269303a0c3d33ab
            GOLANGCI_VERSION=1.64.8
            LINT_CHECKSUM=b6270687afb143d019f387c791cd2a6f1cb383be9b3124d241ca11bd3ce2e54e
            LINT_CHECKSUM_ARM=a6ab58ebcb1c48572622146cdaec2956f56871038a54ed1149f1386e287789a5
        - tag: "1.25"
          build_args: ""
    with:
      image_path: containers/go
      image_name: golang-pipeline
      image_tag: ${{ matrix.params.tag }}
      build_args: ${{ matrix.params.build_args }}
    secrets: inherit

  rebuild-kubernetes:
    needs: rebuild-base
    uses: ./.github/workflows/build-image.yml
    strategy:
      matrix:
        params:
        - tag: "1.31"
          build_args: |
            KUBECTL_VERSION=v1.31.12
            KUBECTL_CHECKSUM=cf609add577be9c898c52027e800a008331d6b2a202ecc61413e847f7a12ccd0
            KUBECTL_CHECKSUM_ARM=1c2cc071a6522682f645c5987c0601be92c14848c5123473904e5ede0721039b
        - tag: "1.32"
          build_args: |
            KUBECTL_VERSION=v1.32.8
            KUBECTL_CHECKSUM=0fc709a8262be523293a18965771fedfba7466eda7ab4337feaa5c028aa46b1b
            KUBECTL_CHECKSUM_ARM=8a7371e54187249389a9aa222b150d61a4a745c121ab24dbcbb56d1ac2d0b912
        - tag: "1.33"
          build_args: |
            KUBECTL_VERSION=v1.33.4
            KUBECTL_CHECKSUM=c2ba72c115d524b72aaee9aab8df8b876e1596889d2f3f27d68405262ce86ca1
            KUBECTL_CHECKSUM_ARM=76cd7a2aa59571519b68c3943521404cbce55dafb7d8866f8d0ea2995b396eef
        - tag: "1.34"
          build_args: ""
    with:
      image_path: containers/kubernetes
      image_name: kubernetes-pipeline
      image_tag: ${{ matrix.params.tag }}
      build_args: ${{ matrix.params.build_args }}
    secrets: inherit

  rebuild-node:
    needs: rebuild-base
    uses: ./.github/workflows/build-image.yml
    strategy:
      matrix:
        params:
        - tag: "20"
          build_args: |
            NODE_VERSION=v20.19.5
            NODE_CHECKSUM=315046739a513a70e03a4a55a8afda8cf979f30852e576075c340084e3f8ac0f
            NODE_CHECKSUM_ARM=d462267863ae8ee556039ebdf559055a8ec562c633889ef1403f3adb449ba1dd
        - tag: "22"
          build_args: ""
    with:
      image_path: containers/node
      image_name: node-pipeline
      image_tag: ${{ matrix.params.tag }}
      build_args: ${{ matrix.params.build_args }}
    secrets: inherit

  rebuild-sysdig:
    needs: rebuild-base
    uses: ./.github/workflows/build-image.yml
    strategy:
      matrix:
        params:
        - tag: "1"
          build_args: ""
    with:
      image_path: containers/sysdig
      image_name: sysdig-pipeline
      image_tag: ${{ matrix.params.tag }}
      build_args: ${{ matrix.params.build_args }}
    secrets: inherit
