name: Image Building

on:
  workflow_dispatch:
  schedule:
  - cron: "0 0 1,15 * *"

jobs:
  rebuild-base:
    uses: ./.github/workflows/build-image.yml
    strategy:
      matrix:
        params:
        - tag: "1"
          build_args: ""
    with:
      image_path: containers/base
      image_name: base-pipeline
      image_tag: ${{ matrix.params.tag }}
      build_args: ${{ matrix.params.build_args }}
    secrets: inherit

  rebuild-docker:
    needs: rebuild-base
    uses: ./.github/workflows/build-image.yml
    strategy:
      matrix:
        params:
        - tag: "1"
          build_args: ""
    with:
      image_path: containers/docker
      image_name: docker-pipeline
      image_tag: ${{ matrix.params.tag }}
      build_args: ${{ matrix.params.build_args }}
    secrets: inherit

  rebuild-go:
    needs: rebuild-base
    uses: ./.github/workflows/build-image.yml
    strategy:
      matrix:
        params:
        - tag: "1.24"
          build_args: |
            GO_VERSION=1.24.6
            GO_CHECKSUM=bbca37cc395c974ffa4893ee35819ad23ebb27426df87af92e93a9ec66ef8712
            GO_CHECKSUM_ARM=124ea6033a8bf98aa9fbab53e58d134905262d45a022af3a90b73320f3c3afd5
            GOLANGCI_VERSION=1.64.8
            LINT_CHECKSUM=b6270687afb143d019f387c791cd2a6f1cb383be9b3124d241ca11bd3ce2e54e
            LINT_CHECKSUM_ARM=a6ab58ebcb1c48572622146cdaec2956f56871038a54ed1149f1386e287789a5
        - tag: "1.25"
          build_args: ""
    with:
      image_path: containers/go
      image_name: golang-pipeline
      image_tag: ${{ matrix.params.tag }}
      build_args: ${{ matrix.params.build_args }}
    secrets: inherit

  rebuild-kubernetes:
    needs: rebuild-base
    uses: ./.github/workflows/build-image.yml
    strategy:
      matrix:
        params:
        - tag: "1.31"
          build_args: |
            KUBECTL_VERSION=v1.31.12
            KUBECTL_CHECKSUM=cf609add577be9c898c52027e800a008331d6b2a202ecc61413e847f7a12ccd0
            KUBECTL_CHECKSUM_ARM=1c2cc071a6522682f645c5987c0601be92c14848c5123473904e5ede0721039b
        - tag: "1.32"
          build_args: |
            KUBECTL_VERSION=v1.32.8
            KUBECTL_CHECKSUM=0fc709a8262be523293a18965771fedfba7466eda7ab4337feaa5c028aa46b1b
            KUBECTL_CHECKSUM_ARM=8a7371e54187249389a9aa222b150d61a4a745c121ab24dbcbb56d1ac2d0b912
        - tag: "1.33"
          build_args: |
            KUBECTL_VERSION=v1.33.4
            KUBECTL_CHECKSUM=c2ba72c115d524b72aaee9aab8df8b876e1596889d2f3f27d68405262ce86ca1
            KUBECTL_CHECKSUM_ARM=76cd7a2aa59571519b68c3943521404cbce55dafb7d8866f8d0ea2995b396eef
        - tag: "1.34"
          build_args: ""
    with:
      image_path: containers/kubernetes
      image_name: kubernetes-pipeline
      image_tag: ${{ matrix.params.tag }}
      build_args: ${{ matrix.params.build_args }}
    secrets: inherit

  rebuild-node:
    needs: rebuild-base
    uses: ./.github/workflows/build-image.yml
    strategy:
      matrix:
        params:
        - tag: "20"
          build_args: |
            NODE_VERSION=v20.19.4
            NODE_CHECKSUM=7a488a09e2fc02fbd1bc4ae084bea8a589314f741c182fc02c5f3f07c79a29d4
            NODE_CHECKSUM_ARM=4492c29882f604eb4cba6ce52ad2e6436f4eeb2b2917a74b0f85e6e42e261252
        - tag: "22"
          build_args: ""
    with:
      image_path: containers/node
      image_name: node-pipeline
      image_tag: ${{ matrix.params.tag }}
      build_args: ${{ matrix.params.build_args }}
    secrets: inherit

  rebuild-sysdig:
    needs: rebuild-base
    uses: ./.github/workflows/build-image.yml
    strategy:
      matrix:
        params:
        - tag: "1"
          build_args: ""
    with:
      image_path: containers/sysdig
      image_name: sysdig-pipeline
      image_tag: ${{ matrix.params.tag }}
      build_args: ${{ matrix.params.build_args }}
    secrets: inherit
