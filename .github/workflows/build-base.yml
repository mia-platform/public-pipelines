name: Build Base Image

on:
  workflow_call:
  schedule:
  - cron: "0 0 1,15 * *"

jobs:
  rebuild-base-image:
    uses: ./.github/workflows/build-image.yml
    with:
      image_path: containers/base
      image_name: base-pipeline
      image_tag: "1"
    secrets:
      DOCKER_USERNAME: ${{ secrets.BOT_DOCKER_USERNAME }}
      DOCKER_TOKEN: ${{ secrets.BOT_DOCKER_TOKEN }}
      GH_USERNAME: ${{ secrets.BOT_USER }}
      GH_TOKEN: ${{ secrets.BOT_GITHUB_TOKEN }}

  rebuild-docker:
    uses: ./.github/workflows/build-docker.yml
    needs: rebuild-base-image
    secrets:
      BOT_DOCKER_USERNAME: ${{ secrets.BOT_DOCKER_USERNAME }}
      BOT_DOCKER_TOKEN: ${{ secrets.BOT_DOCKER_TOKEN }}
      BOT_USER: ${{ secrets.BOT_USER }}
      BOT_GITHUB_TOKEN: ${{ secrets.BOT_GITHUB_TOKEN }}

  rebuild-go:
    uses: ./.github/workflows/build-go.yml
    needs: rebuild-base-image
    secrets:
      BOT_DOCKER_USERNAME: ${{ secrets.BOT_DOCKER_USERNAME }}
      BOT_DOCKER_TOKEN: ${{ secrets.BOT_DOCKER_TOKEN }}
      BOT_USER: ${{ secrets.BOT_USER }}
      BOT_GITHUB_TOKEN: ${{ secrets.BOT_GITHUB_TOKEN }}

  rebuild-kubernetes:
    uses: ./.github/workflows/build-kubernetes.yml
    needs: rebuild-base-image
    secrets:
      BOT_DOCKER_USERNAME: ${{ secrets.BOT_DOCKER_USERNAME }}
      BOT_DOCKER_TOKEN: ${{ secrets.BOT_DOCKER_TOKEN }}
      BOT_USER: ${{ secrets.BOT_USER }}
      BOT_GITHUB_TOKEN: ${{ secrets.BOT_GITHUB_TOKEN }}

  rebuild-node:
    uses: ./.github/workflows/build-node.yml
    needs: rebuild-base-image
    secrets:
      BOT_DOCKER_USERNAME: ${{ secrets.BOT_DOCKER_USERNAME }}
      BOT_DOCKER_TOKEN: ${{ secrets.BOT_DOCKER_TOKEN }}
      BOT_USER: ${{ secrets.BOT_USER }}
      BOT_GITHUB_TOKEN: ${{ secrets.BOT_GITHUB_TOKEN }}

  rebuild-sysdig:
    uses: ./.github/workflows/build-sysdig.yml
    needs: rebuild-base-image
    secrets:
      BOT_DOCKER_USERNAME: ${{ secrets.BOT_DOCKER_USERNAME }}
      BOT_DOCKER_TOKEN: ${{ secrets.BOT_DOCKER_TOKEN }}
      BOT_USER: ${{ secrets.BOT_USER }}
      BOT_GITHUB_TOKEN: ${{ secrets.BOT_GITHUB_TOKEN }}
